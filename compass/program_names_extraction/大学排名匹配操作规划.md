# 大学排名匹配操作规划

## 项目概述
将大学排名数据（CSV文件）匹配到各个专业的大学项目JSON文件中，为每个项目添加5个排名字段。

## 现有数据结构分析

### 1. 排名数据文件
- **文件位置**: `univ_rankings_all_and_by_subject.csv`
- **包含字段**:
  - 基本信息: 学校中文名, 学校英文名, 国家/地区
  - 综合排名: QS 2026, USNews 2026, THE 2025, ARWU 2024
  - 专业排名: 按学科分类的QS 2026排名（如Computer Science, Data Science等）

### 2. 项目数据文件
- **文件位置**: `raw_data/` 目录下各专业JSON文件
- **现有字段结构**:
  - 基本信息: university_name, university_name_en, program_name等
  - 需要添加的新字段: 4个综合排名 + 1个专业排名

## 操作计划

### 第一阶段：数据预处理
1. **读取并清理排名CSV数据**
   - 处理空值和特殊标记（如"=7", "51-100"等）
   - 建立大学名称映射表（中英文对照）
   - 提取各专业对应的QS 2026专业排名字段

2. **创建专业类别到QS学科映射表**
   - 基于`all_program_names.csv`中的category字段建立映射表
   - 每个中文专业类别对应1-2个QS学科排名字段
   - 映射表将作为专业排名匹配的唯一依据

### 第二阶段：匹配算法设计
1. **大学名称匹配策略**
   - 第一层：英文名称精确匹配
   - 第二层：中文名称精确匹配
   - 第三层：模糊匹配（处理名称变体、简称、缩写）
     - 去除常见词汇（University, College, Institute等）
     - 处理缩写形式（如MIT, UCL等）
     - 使用字符串相似度算法（如Levenshtein距离）
     - 处理常见翻译差异
   - 第四层：手动匹配规则（基于预定义映射表）
   - 建立匹配置信度评估（精确>模糊>手动）

2. **专业排名字段选择策略**
   - **使用预先建立的类别映射表**，见ProgramDB/compass/program_names_extraction/专业类别到QS学科映射表.csv
   - 直接根据项目的`category`字段查找对应的QS学科排名字段
   - 映射表包含62个主要中文专业类别到QS学科的对应关系
   - 每个类别最多对应2个QS学科，将映射表中的“QS主要学科”和“QS备选学科”都添加上去
   - 简化匹配过程，确保一致性和可靠性

### 第三阶段：数据增强实施
1. **为每个项目添加5-6个新字段**:
   - `qs_2026_rank`: QS 2026综合排名
   - `usnews_2026_rank`: USNews 2026综合排名  
   - `the_2025_rank`: THE 2025综合排名
   - `arwu_2024_rank`: ARWU 2024综合排名
   - `qs_2026_subject_primary_rank`: QS 2026主要专业排名（基于映射表的primary字段）
   - `qs_2026_subject_secondary_rank`: QS 2026备选专业排名（基于映射表的secondary字段，可能为空）

2. **批量处理所有JSON文件**
   - 遍历raw_data目录下所有专业文件
   - 对每个项目根据category字段查找映射表中的primary和secondary QS学科
   - 为每个项目添加对应的专业排名字段：
     - 所有项目都添加`qs_2026_subject_primary_rank`字段
     - 仅当映射表中secondary不为null时，添加`qs_2026_subject_secondary_rank`字段
   - 保持原有数据结构不变
   - 生成处理日志和匹配报告

### 第四阶段：质量保证
1. **数据验证**
   - 检查匹配成功率
   - 验证排名数据的合理性
   - 生成未匹配大学的列表

2. **输出处理结果**
   - 更新后的JSON文件保存到processed_data目录
   - 生成匹配统计报告
   - 记录处理过程中的异常情况

## 技术实现要点

### 1. 大学名称标准化
- 去除括号内容和特殊字符
- 统一大小写和空格处理
- 处理常见的大学名称变体

### 2. 排名数据处理
- 将"=7"格式转换为数值7
- 将"51-100"格式转换为中位数75.5
- 空值或"-"标记为null

### 3. 错误处理机制
- 记录无法匹配的大学名称
- 处理排名数据异常值
- 提供手动修正接口

## 预期输出
- 增强后的JSON文件（包含排名信息）
- 匹配成功率统计报告
- 未匹配大学列表
- 数据质量评估报告

## 风险评估
1. **大学名称不一致**: 需要建立完善的名称映射机制
2. **类别映射准确性**: 需要确保62个中文类别到QS学科的映射准确合理
3. **数据完整性**: 部分大学可能缺少某些排名数据
4. **性能考虑**: 大量JSON文件的批量处理需要优化

## 类别映射表策略说明
- **简化策略**: 使用category字段直接映射，避免复杂的语义分析
- **一致性保证**: 同一类别下的所有项目使用相同的QS学科排名
- **可维护性**: 映射关系清晰明确，便于后续调整和维护
- **处理效率**: 大幅提升处理速度，避免逐个项目的复杂匹配

## 专业排名字段说明

### 字段结构
每个项目将根据其category字段，添加1-2个专业排名字段：

1. **qs_2026_subject_primary_rank** (必有)
   - 基于映射表中的"primary"QS学科字段
   - 所有项目都会添加此字段
   - 代表该专业类别的主要学科排名

2. **qs_2026_subject_secondary_rank** (可选)
   - 基于映射表中的"secondary"QS学科字段
   - 仅当映射表中secondary不为null时添加
   - 提供备选的专业排名参考

### 字段添加示例
- **计算机类项目**: 添加2个字段
  - `qs_2026_subject_primary_rank`: Computer Science排名
  - `qs_2026_subject_secondary_rank`: Data Science排名
  
- **法律类项目**: 添加1个字段
  - `qs_2026_subject_primary_rank`: Law排名
  - (无secondary字段，因为映射表中secondary为null)

### 数据处理逻辑
1. 读取项目的category字段
2. 在映射表中查找对应的primary和secondary QS学科
3. 在排名CSV中查找该大学对应学科的排名数据
4. 将排名数据填入对应的专业排名字段
5. 如果找不到排名数据，字段值设为null

## 后续扩展
- 支持更多排名系统
- 动态更新排名数据
- 提供可视化分析工具